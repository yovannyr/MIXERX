<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MIXERX.MAUI.ViewModels"
             x:Class="MIXERX.MAUI.Views.LibraryPage"
             x:DataType="vm:LibraryViewModel"
             Title="Library"
             BackgroundColor="{StaticResource BackgroundDark}">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Search Bar -->
        <Frame Grid.Row="0" BackgroundColor="{StaticResource BackgroundLight}" Padding="15" Margin="10">
            <Grid ColumnDefinitions="*,Auto">
                <SearchBar Grid.Column="0" 
                          Placeholder="Search tracks..." 
                          Text="{Binding SearchText}"
                          BackgroundColor="{StaticResource BackgroundDark}"
                          TextColor="White"/>
                <Button Grid.Column="1" 
                       Text="Import" 
                       Style="{StaticResource PrimaryButton}" 
                       Command="{Binding ImportDirectoryCommand}"
                       Margin="10,0,0,0"/>
            </Grid>
        </Frame>

        <!-- Track List -->
        <CollectionView Grid.Row="1" 
                       ItemsSource="{Binding Tracks}"
                       SelectedItem="{Binding SelectedTrack}"
                       SelectionMode="Single"
                       Margin="10,0">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:TrackViewModel">
                    <Frame BackgroundColor="{StaticResource BackgroundLight}" 
                          Padding="15" 
                          Margin="0,5"
                          CornerRadius="8">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:LibraryViewModel}}, Path=LoadTrackCommand}" 
                                                CommandParameter="{Binding .}"/>
                        </Frame.GestureRecognizers>
                        
                        <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                            <!-- Track Info -->
                            <StackLayout Grid.Column="0">
                                <Label Text="{Binding DisplayTitle}" 
                                      FontSize="16" 
                                      FontAttributes="Bold" 
                                      TextColor="White"/>
                                <Label Text="{Binding DisplayArtist}" 
                                      FontSize="14" 
                                      TextColor="#AAAAAA"/>
                            </StackLayout>
                            
                            <!-- BPM -->
                            <StackLayout Grid.Column="1" Margin="10,0">
                                <Label Text="BPM" FontSize="10" TextColor="#888888" HorizontalOptions="Center"/>
                                <Label Text="{Binding DisplayBpm}" 
                                      FontSize="14" 
                                      FontAttributes="Bold" 
                                      TextColor="{StaticResource Primary}"
                                      HorizontalOptions="Center"/>
                            </StackLayout>
                            
                            <!-- Key -->
                            <StackLayout Grid.Column="2" Margin="10,0">
                                <Label Text="KEY" FontSize="10" TextColor="#888888" HorizontalOptions="Center"/>
                                <Label Text="{Binding DisplayKey}" 
                                      FontSize="14" 
                                      FontAttributes="Bold" 
                                      TextColor="{StaticResource Accent}"
                                      HorizontalOptions="Center"/>
                            </StackLayout>
                            
                            <!-- Duration -->
                            <StackLayout Grid.Column="3" Margin="10,0">
                                <Label Text="TIME" FontSize="10" TextColor="#888888" HorizontalOptions="Center"/>
                                <Label Text="{Binding DisplayDuration}" 
                                      FontSize="14" 
                                      TextColor="White"
                                      HorizontalOptions="Center"/>
                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        
    </Grid>

</ContentPage>
